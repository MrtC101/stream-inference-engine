
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mrtc101.github.io/stream-inference-engine/2_architecture/">
      
      
        <link rel="prev" href="../1_overview/">
      
      
        <link rel="next" href="../3_performance/">
      
      
        
          <link rel="alternate" href="./" hreflang="en">
        
          <link rel="alternate" href="../es/2_architecture/" hreflang="es">
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Architecture - Project Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Project Documentation" class="md-header__button md-logo" aria-label="Project Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Project Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../es/2_architecture/" hreflang="es" class="md-select__link">
              Español
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Project Documentation" class="md-nav__button md-logo" aria-label="Project Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Project Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Stream Inference Engine
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../1_overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conceptual-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conceptual Modules
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-flow-and-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Control Flow and Communication
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-dependencies-and-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      
        External Dependencies and Hardware
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalability-and-conceptual-limits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scalability and Conceptual Limits
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conceptual-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conceptual Metrics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensibility-and-ownership" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extensibility and Ownership
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../3_performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Performance
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../4_engineering-decisions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Engineering Decisions
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../5_limitations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Limitations
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../6_production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Production (MVP)
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conceptual-modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conceptual Modules
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#control-flow-and-communication" class="md-nav__link">
    <span class="md-ellipsis">
      
        Control Flow and Communication
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#external-dependencies-and-hardware" class="md-nav__link">
    <span class="md-ellipsis">
      
        External Dependencies and Hardware
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scalability-and-conceptual-limits" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scalability and Conceptual Limits
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conceptual-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        Conceptual Metrics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extensibility-and-ownership" class="md-nav__link">
    <span class="md-ellipsis">
      
        Extensibility and Ownership
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="architecture">Architecture</h1>
<p>This section describes the structural decomposition of the system into conceptual modules, the data and control flow between them, and the communication mechanisms used. It defines critical external dependencies (hardware, drivers, and frameworks), the current scalability limits under the target hardware, and the metrics considered for evaluating behavior. It also delimits the extensibility of components and the ownership model within the MVP scope.</p>
<h2 id="conceptual-modules">Conceptual Modules</h2>
<p>The system is organized into two planes: control and data.</p>
<p><strong>Control Plane</strong>
- <strong>API</strong>: Interface to other services. Manages configurations, model weights, and database persistence.
- <strong>Engine</strong>: Central orchestrator. Manages the run lifecycle through database polling and coordinates Workers and Stream Manager via IPC.
- <strong>Database</strong>: State mediator between API and Engine.</p>
<p><strong>Data Plane</strong>
- <strong>Workers (0..N)</strong>: Independent processes, one per active stream. Each Worker runs an Inference Pipeline that ingests the RTSP source, applies inference and drawing over frames, encodes them as H264, and writes to shared memory.
- <strong>Shared Memory</strong>: Frame transfer mechanism between Workers and Stream Manager.
- <strong>Stream Manager</strong>: Central process of the data plane. Contains the Factory Pipeline, which reads frames from shared memory and publishes them through the RTSP server.</p>
<pre class="mermaid"><code>flowchart TB
    subgraph CP["Control Plane"]
        direction TB
        API["REST API"] &lt;--&gt; DB[(SQLite)] &lt;--&gt; ENG["Engine &lt;br/&gt; (Lifecycle · Polling · IPC)"]
    end

    subgraph DP["Data Plane"]
        direction LR
        SRC["RTSP Sources &lt;br/&gt; (0..N)"]
        IP["Workers (0..N) &lt;br/&gt; Inference Pipeline &lt;br/&gt; (GStreamer + DeepStream) &lt;br/&gt; Ingestion · Inference &lt;br/&gt; Drawing · Encode"]
        SHM[/"Shared Memory"/]
        FP["Stream Manager &lt;br/&gt; Factory Pipeline &lt;br/&gt; RTSP Server"]
        OUT["RTSP Consumers &lt;br/&gt; (0..N)"]
        SRC --&gt; IP
        IP --&gt;|"H264 frames"| SHM --&gt; FP --&gt; OUT
    end

    ENG -.-&gt; DP

    classDef control fill:#dbeafe,stroke:#3b82f6,color:#1e3a5f
    classDef data fill:#dcfce7,stroke:#22c55e,color:#14532d
    classDef external fill:#fef9c3,stroke:#eab308,color:#422006
    classDef memory fill:#fce7f3,stroke:#ec4899,color:#500724

    class API,DB,ENG control
    class IP,FP data
    class SRC,OUT external
    class SHM memory</code></pre>
<hr />
<h2 id="control-flow-and-communication">Control Flow and Communication</h2>
<ul>
<li>API and Engine communicate exclusively through the database.</li>
<li>Engine coordinates Workers and Stream Manager via IPC (stdin/stdout) with JSON messages.</li>
<li>Processed frames are transferred between Workers and Stream Manager through shared memory.</li>
<li>All components must be operational to execute a run; if any fails, the run does not complete.</li>
</ul>
<hr />
<h2 id="external-dependencies-and-hardware">External Dependencies and Hardware</h2>
<ul>
<li>Strong dependency on GPU architecture: Tesla V100, NVIDIA T4, Jetson.</li>
<li>Required libraries and frameworks: CUDA 12.6, cuDNN, DeepStream 7.1, pyds, GStreamer plugins, specific NVIDIA drivers, YOLO, PyTorch, TensorRT.</li>
<li>API and Engine depend on the database (currently local).</li>
<li>Modules depend on available hardware to meet expected performance.</li>
</ul>
<hr />
<h2 id="scalability-and-conceptual-limits">Scalability and Conceptual Limits</h2>
<ul>
<li>Current limit: 6 1080p streams with full-frame inference using a YOLO nano model.</li>
<li>Estimated potential: ~10 streams with resource optimization and without scaling hardware.</li>
<li>Current consumption for 6 streams: 16 GB RAM, &lt;12 GB VRAM, Tesla V100 GPU, 6 CPU cores.</li>
<li>Scaling via additional hardware is faster but costly; code optimization can improve efficiency without increasing resources.</li>
</ul>
<hr />
<h2 id="conceptual-metrics">Conceptual Metrics</h2>
<ul>
<li>Frame drop rate, end-to-end latency, and processing latency are measured.</li>
<li>The Factory Pipeline measures only end-to-end latency; frame drop is not representative given that it re-consumes the same frames from shared memory.</li>
<li>Real measurement is limited due to loss of frame identity between pipelines.</li>
<li>Future improvements: add per-frame metadata for traceability between pipelines and precise throughput and latency measurement.</li>
</ul>
<hr />
<h2 id="extensibility-and-ownership">Extensibility and Ownership</h2>
<ul>
<li>Modules such as rule validation, rule evaluation, model loading, and drawing are extensible, though they require developer intervention.</li>
<li>Engine orchestrates all modules; API almost fully decouples interaction through the database.</li>
<li>The conceptual design allows scaling and modifying functionality without affecting other modules, within MVP boundaries.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>